#!groovy

@Library("Infrastructure")

def type = "java"
def product = "hmc"
def component = "hmi-outbound-adapter"

// Other env variables needed for BEFTA.
env.BEFTA_RESPONSE_HEADER_CHECK_POLICY="JUST_WARN"
env.OAUTH2_CLIENT_ID = "ccd_gateway"

withPipeline(type, product, component) {
  enableAksStagingDeployment()
  disableLegacyDeployment()

  after('test') {
    // hmcts/cnp-jenkins-library may fail to copy artifacts after checkstyle error so repeat command (see /src/uk/gov/hmcts/contino/GradleBuilder.groovy)
    steps.archiveArtifacts allowEmptyArchive: true, artifacts: '**/reports/checkstyle/*.html'
  }

  after('smoketest:preview') {
    steps.archiveArtifacts allowEmptyArchive: true, artifacts: '**/BEFTA Report for Smoke Tests/**/*'
  }

  after('smoketest:aat') {
    steps.archiveArtifacts allowEmptyArchive: true, artifacts: '**/BEFTA Report for Smoke Tests/**/*'
  }

  after('functionalTest:preview') {
    steps.archiveArtifacts allowEmptyArchive: true, artifacts: '**/BEFTA Report for Functional Tests/**/*'
  }

  after('functionalTest:aat') {
    steps.archiveArtifacts allowEmptyArchive: true, artifacts: '**/BEFTA Report for Functional Tests/**/*'
  }
}
